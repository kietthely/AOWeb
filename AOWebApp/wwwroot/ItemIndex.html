<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, inital-scale=1"/>
    <link href="lib/bootstrap/dist/css/bootstrap.css" rel="stylesheet"/>
    <title>Shop Items</title>
</head>
<body>


    <div class="container">
        <h1 class="alert-secondary p-2 text-center" mb-3>Shop Items</h1>
        <div class="row mb-3">
            <div class="col-3">
                <input type="text" name="searchText" class="form-control" placeholder="Product name..." value="" />

            </div>
            <div class="col-3">
                <select name="categoryId" class="form-control">
                    <option value="">All categories</option>
                </select>
            </div>
            <div class="col">
                <button type="button" id="searchButton">Search</button>
            </div>

        </div>


        <div class="row justify-content-center">
            <div class="col-4 mb-2">
                <div class="card">
                    <img src="..." class="card-img-top" alt="...">
                    <div class="card-body">
                        <h5 class="card-title">Card title</h5>
                        <p class="card-text">Card Text</p>
                        <p class="card-text">Price</p>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>

        //function categoryList() {
        //    fetch('/api/ParentCategoriesWebAPI')
        //        .then((response) => response.json())
        //        .then(data =>
        //        {
        //            let select = document.querySelector('select[name="categoryId"]');
        //            data.forEach(c => {
        //                let opt = document.createElement("option");
        //                opt.value = c.categoryId;
        //                opt.innerText = c.categoryName;
        //                select.appendChild(opt);
        //            });
        //        });
        //}
        var buttonRef = document.getElementById("searchButton");
            buttonRef.addEventListener("click", searchEvent, false);
        
        function searchEvent() {
            fetch('/api/ItemsWebAPI')
                .then((response) => response.json())
                .then(data => {
                    var searchElement = document.querySelector('input[name="searchText"]');
                    var searchValue = searchElement.value;
                    let searchData = data.filter(item => item.itemName.includes(searchValue));
                    buildItems(searchData);

                }
                )
                .catch(error => console.error("Unable to get items: ", error));
        }

        function buildItems(data) {
            var row = document.querySelector(".row.justify-content-center");
            // select all cards
            //var test = document.querySelectorAll("div.col-4 [hidden]");
            // select all not hidden cards from a list of cards
            //test.forEach(card => card.remove())
            //var nonHiddenCards = test.querySelector("not:([hidden])");
            // Remove all existing cards
            //nonHiddenCards.forEach(card => card.remove());
            
            //var firstCard = row.querySelector("div.col-4");

            //// hidden attribute
            //firstCard.setAttribute("hidden", false);
            for (let i = 0; i < data.length; i++) {

                var col = row.querySelector("div.col-4").cloneNode(true);

                col.querySelector("h5").innerText = data[i].itemName;
                let cardTextList = col.querySelectorAll("p");
                cardTextList[0].innerText = data[i].itemDescription;
                cardTextList[1].innerText = data[i].itemCost;

                let img = col.querySelector("img");
                img.setAttribute("src", data[i].itemImage)

                img.setAttribute("alt", "image of " + data[i].itemName)

                row.appendChild(col);



                if (i == (data.length - 1)) {
                    var firstCard = row.querySelector("div.col-4");
                    // hidden attribute
                    firstCard.setAttribute("hidden", true);

                }
            }
        }

        fetch('/api/ItemsWebAPI')
            .then((response) => response.json())
            .then(data => buildItems(data))
            .catch(error => console.error("Unable to get items: ", error));

    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
</body>
</html>